(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function o(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(e){if(e.ep)return;e.ep=!0;const a=o(e);fetch(e.href,a)}})();const _e="modulepreload",Ge=function(n){return"/"+n},be={},Ke=function(t,o,l){let e=Promise.resolve();if(o&&o.length>0){let u=function(T){return Promise.all(T.map(y=>Promise.resolve(y).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),c=d?.nonce||d?.getAttribute("nonce");e=u(o.map(T=>{if(T=Ge(T),T in be)return;be[T]=!0;const y=T.endsWith(".css"),S=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${T}"]${S}`))return;const b=document.createElement("link");if(b.rel=y?"stylesheet":_e,y||(b.as="script"),b.crossOrigin="",b.href=T,c&&b.setAttribute("nonce",c),document.head.appendChild(b),y)return new Promise((k,U)=>{b.addEventListener("load",k),b.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${T}`)))})}))}function a(d){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=d,window.dispatchEvent(c),!c.defaultPrevented)throw d}return e.then(d=>{for(const c of d||[])c.status==="rejected"&&a(c.reason);return t().catch(a)})},ze={version:1,ui:{palette:{bg:"#070812",panelRGBA:"rgba(14,18,38,0.72)",neonCyan:"#22F5FF",neonMagenta:"#FF2BD6",neonLime:"#B6FF2E",danger:"#FF3B3B",text:"#EAF0FF"},tipsTR:["Raslantı yok: Aynı girdiler aynı sonucu üretir.","Dalga süresi sabittir; başarını Öldürme Oranı belirler.","Ceza, süreyi değil ödülü/hasarı etkiler.","Modüller seçerek açılır; drop-rate yoktur.","Kalite düşürmek mobilde düşman sayısını sınırlar.","Prestij: reset + kalıcı çarpan (deterministik)."]},sim:{tickHz:60,waveDurationSec:30,timeScales:[1,2,4],autoOverlayCloseSec:1.6},progression:{clearFactorRho:.9,d0:8,dmgGrowthD:.095,r0:1.1,rMax:8,fireRateLogK:.55,prestigeMu:.06,a:.042,b:.028,c:.018,earlyEnd:50,midEnd:200,nMin:10,nMaxHigh:90,nMaxMed:70,nMaxLow:50,u:1.9,v:2.2,spawnP:1.6,enemyTypeA:17,enemyTypeB:29,enemyTypeC:7,patternP1:9,patternP2:4,patternCountP:12,burstPatternValues:[3,7,10],burstTightness:.42,typeVariationBeta:.28,typeVariationM:9,armorMax:.75,armorAlpha:.12,speedK:.9,th0:.7,thSlope:.07,thMin:.7,thMax:.92,penK:.9,penMin:.4,g0:.55,gamma:.72,goldWaveK:.18,p0:1,pointsGrowthPer10:1.28,enableEscapeDamage:!0,escapeDamage:2,deficitBoost:1.6,offlineFactor:.6,rewardedOfflineFactor:1.2,offlineKillK0:.22,offlineKillK1:.75},tower:{baseRange:160,rangeGrowth:4,baseHP0:100,baseHPGrowth:.08,armorPierce0:0},economy:{upgradeCostBase:10,upgradeCostGrowth:1.13,moduleUnlockPointCostBase:2,moduleUnlockPointCostGrowth:1.22,moduleUpgradeGoldBase:25,moduleUpgradeGoldGrowth:1.16},enemies:{types:[{id:"V1",nameTR:"Vektör",color:"#22F5FF",hpMult:1,armorMult:1,baseSpeed:58},{id:"PR",nameTR:"Prizma",color:"#FF2BD6",hpMult:1.25,armorMult:1.1,baseSpeed:52},{id:"IO",nameTR:"İyon",color:"#B6FF2E",hpMult:.85,armorMult:.9,baseSpeed:68},{id:"NX",nameTR:"Nexus",color:"#EAF0FF",hpMult:1.6,armorMult:1.25,baseSpeed:46},{id:"CR",nameTR:"Krom",color:"#7A7CFF",hpMult:1.05,armorMult:1.55,baseSpeed:50},{id:"PH",nameTR:"Faz",color:"#FFB000",hpMult:.95,armorMult:.85,baseSpeed:74}]},modules:{slotCount:6,defs:[{id:"MX_FLUX",nameTR:"Akı Çarpanı",category:"OFFENSE",iconConcept:"çift halka + oklar",dmgMultPerLevel:.06},{id:"MX_SPARK",nameTR:"Kıvılcım İletkeni",category:"OFFENSE",iconConcept:"neon şimşek izleri",dmgFlatPerLevel:2.4},{id:"MX_PRISM",nameTR:"Prizma Odak",category:"OFFENSE",iconConcept:"üçgen prizma + ışın",dmgMultPerLevel:.04,fireRateBonusPerLevel:.04},{id:"MX_OVERCLK",nameTR:"Aşırı Saat",category:"OFFENSE",iconConcept:"saat kadranı + hız çizgisi",fireRateBonusPerLevel:.08},{id:"MX_LENS",nameTR:"Mercek Dizisi",category:"OFFENSE",iconConcept:"altıgen lens petek",rangeBonusPerLevel:6},{id:"MX_PIERCE",nameTR:"Zırh Yarıcı",category:"OFFENSE",iconConcept:"delici ok ucu",armorPiercePerLevel:.04},{id:"DF_BULWARK",nameTR:"Siper Protokolü",category:"DEFENSE",iconConcept:"kalkan + grid",baseHPBonusPerLevel:8},{id:"DF_REGEN",nameTR:"Tamir Nanolifi",category:"DEFENSE",iconConcept:"dikiş izi + dalga",baseHPBonusPerLevel:5},{id:"DF_SHELL",nameTR:"Cam Zırh",category:"DEFENSE",iconConcept:"cam kubbe",baseHPBonusPerLevel:10},{id:"UT_MINT",nameTR:"Mikro Darphane",category:"UTILITY",iconConcept:"mikroçip + madeni",goldMultPerLevel:.03},{id:"UT_LOG",nameTR:"Telemetri Kaydı",category:"UTILITY",iconConcept:"grafik çizgisi",goldMultPerLevel:.02},{id:"UT_CALIB",nameTR:"Kalibrasyon Ringi",category:"UTILITY",iconConcept:"halkalar + işaret",dmgMultPerLevel:.02,goldMultPerLevel:.01},{id:"MX_GAUSS",nameTR:"Gauss Kızağı",category:"OFFENSE",iconConcept:"ray + parçacık",dmgMultPerLevel:.05},{id:"MX_NODE",nameTR:"Nöral Düğüm",category:"UTILITY",iconConcept:"bağlantılı noktalar",fireRateBonusPerLevel:.03,goldMultPerLevel:.015},{id:"DF_COOLANT",nameTR:"Soğutma Hattı",category:"DEFENSE",iconConcept:"boru + kar tanesi",baseHPBonusPerLevel:6},{id:"MX_VECTOR",nameTR:"Vektör Eğrisi",category:"OFFENSE",iconConcept:"eğri ok",dmgFlatPerLevel:1.7,fireRateBonusPerLevel:.03},{id:"MX_QUANTA",nameTR:"Kuantum İz",category:"OFFENSE",iconConcept:"iki iz + faz kayması",dmgMultPerLevel:.03,armorPiercePerLevel:.02},{id:"UT_ROUTER",nameTR:"Sinyal Yönlendirici",category:"UTILITY",iconConcept:"yön okları",rangeBonusPerLevel:3,goldMultPerLevel:.015},{id:"MX_ARC",nameTR:"Ark Dizini",category:"OFFENSE",iconConcept:"ark çizgisi",dmgMultPerLevel:.02},{id:"MX_CHORD",nameTR:"Akor Rezonansı",category:"OFFENSE",iconConcept:"dalga formu",dmgFlatPerLevel:1.2},{id:"MX_SPECTR",nameTR:"Spektrum Ayarı",category:"OFFENSE",iconConcept:"renk bantları",fireRateBonusPerLevel:.02},{id:"DF_ANCHOR",nameTR:"Çapa Alanı",category:"DEFENSE",iconConcept:"çapa simgesi",baseHPBonusPerLevel:4},{id:"DF_LOCK",nameTR:"Kilitleme Hücresi",category:"DEFENSE",iconConcept:"kilit",baseHPBonusPerLevel:3.5},{id:"UT_INDEX",nameTR:"İndeksleyici",category:"UTILITY",iconConcept:"etiket",goldMultPerLevel:.01},{id:"MX_DELTA",nameTR:"Delta İtki",category:"OFFENSE",iconConcept:"Δ işareti",dmgMultPerLevel:.02},{id:"MX_FOCUS",nameTR:"Odak Noktası",category:"OFFENSE",iconConcept:"nişangâh",dmgFlatPerLevel:1},{id:"UT_BUFFER",nameTR:"Arabellek",category:"UTILITY",iconConcept:"kutu yığını",goldMultPerLevel:.012},{id:"DF_GRID",nameTR:"Kalkan Izgarası",category:"DEFENSE",iconConcept:"ızgara",baseHPBonusPerLevel:4.5},{id:"MX_TACH",nameTR:"Takiyon Darbe",category:"OFFENSE",iconConcept:"hız oku",fireRateBonusPerLevel:.02},{id:"MX_GLYPH",nameTR:"Glif Kesiti",category:"OFFENSE",iconConcept:"rün benzeri işaret",dmgMultPerLevel:.015},{id:"UT_LEDGER",nameTR:"Siber Defter",category:"UTILITY",iconConcept:"defter",goldMultPerLevel:.01},{id:"DF_VAULT",nameTR:"Kaset Kasa",category:"DEFENSE",iconConcept:"kasa",baseHPBonusPerLevel:5},{id:"MX_PHASE",nameTR:"Faz Sıyırma",category:"OFFENSE",iconConcept:"faz halkası",armorPiercePerLevel:.015},{id:"UT_CLOCK",nameTR:"Zaman Damgası",category:"UTILITY",iconConcept:"saat",goldMultPerLevel:.012},{id:"DF_CORE",nameTR:"Çekirdek Güvencesi",category:"DEFENSE",iconConcept:"çekirdek",baseHPBonusPerLevel:6.5},{id:"MX_HEX",nameTR:"Altıgen Kafes",category:"OFFENSE",iconConcept:"hex kafes",dmgMultPerLevel:.012},{id:"UT_MAP",nameTR:"Patika Haritası",category:"UTILITY",iconConcept:"harita",rangeBonusPerLevel:2},{id:"MX_BEAM",nameTR:"Işın Daraltıcı",category:"OFFENSE",iconConcept:"ince ışın",dmgFlatPerLevel:.8},{id:"DF_SEAL",nameTR:"Sızdırmazlık",category:"DEFENSE",iconConcept:"mühür",baseHPBonusPerLevel:3},{id:"UT_LINK",nameTR:"Bağlantı Protokolü",category:"UTILITY",iconConcept:"zincir",goldMultPerLevel:.01},{id:"MX_ORBIT",nameTR:"Yörünge Çentiği",category:"OFFENSE",iconConcept:"yörünge",fireRateBonusPerLevel:.015},{id:"MX_RAIL",nameTR:"Ray İmzası",category:"OFFENSE",iconConcept:"paralel çizgiler",dmgMultPerLevel:.015},{id:"DF_FUSE",nameTR:"Sigorta Bankası",category:"DEFENSE",iconConcept:"sigorta",baseHPBonusPerLevel:2.5},{id:"UT_ARCHIVE",nameTR:"Arşiv Modu",category:"UTILITY",iconConcept:"arşiv kutusu",goldMultPerLevel:.008},{id:"MX_PULSE",nameTR:"Darbe Dizisi",category:"OFFENSE",iconConcept:"nabız",dmgFlatPerLevel:.9},{id:"DF_SPINE",nameTR:"Omurga Çerçeve",category:"DEFENSE",iconConcept:"omurga",baseHPBonusPerLevel:3.5},{id:"UT_AUDIT",nameTR:"Denetim Kaydı",category:"UTILITY",iconConcept:"check",goldMultPerLevel:.01}]}},Pe="neon-grid.save.v1";function Xe(){return{audioMaster:.8,quality:"high",numberFormat:"suffix",reduceEffects:!1,language:"tr"}}function We(){return{totalKills:0,totalEscapes:0,bestWave:1,runsCount:0,totalTimeSec:0}}function se(n,t){const o={},l={};for(const c of n.modules.defs)o[c.id]=!1,l[c.id]=0;const e=n.modules.defs[0],a=n.modules.defs[1];e&&(o[e.id]=!0),a&&(o[a.id]=!0);const d={};for(let c=1;c<=n.modules.slotCount;c++)d[c]=null;return{version:n.version,lastSaveTimestampUTC:t,wave:1,gold:0,points:0,baseHP:n.tower.baseHP0,towerUpgrades:{damageLevel:1,fireRateLevel:1,rangeLevel:1,baseHPLevel:1},modulesUnlocked:o,modulesEquipped:d,moduleLevels:l,prestigePoints:0,settings:Xe(),stats:We()}}function Ye(n,t){const o=localStorage.getItem(Pe);if(!o)return{state:se(n,t)};try{const l=JSON.parse(o);if(!l||typeof l!="object")throw new Error("Invalid save");return{state:qe(n,l,t)}}catch{return{state:se(n,t)}}}function qe(n,t,o){const l=se(n,o),e={...l,...t,version:n.version},a=e;(!e.towerUpgrades||typeof e.towerUpgrades!="object")&&(e.towerUpgrades={...l.towerUpgrades}),typeof e.towerUpgrades.damageLevel!="number"&&(e.towerUpgrades.damageLevel=typeof a.towerLevel=="number"?a.towerLevel:l.towerUpgrades.damageLevel),typeof e.towerUpgrades.fireRateLevel!="number"&&(e.towerUpgrades.fireRateLevel=l.towerUpgrades.fireRateLevel),typeof e.towerUpgrades.rangeLevel!="number"&&(e.towerUpgrades.rangeLevel=l.towerUpgrades.rangeLevel),typeof e.towerUpgrades.baseHPLevel!="number"&&(e.towerUpgrades.baseHPLevel=l.towerUpgrades.baseHPLevel);for(const d of n.modules.defs)typeof e.modulesUnlocked[d.id]!="boolean"&&(e.modulesUnlocked[d.id]=!1),typeof e.moduleLevels[d.id]!="number"&&(e.moduleLevels[d.id]=0);for(let d=1;d<=n.modules.slotCount;d++)d in e.modulesEquipped||(e.modulesEquipped[d]=null);return(!e.lastSaveTimestampUTC||e.lastSaveTimestampUTC<=0)&&(e.lastSaveTimestampUTC=o),e}function Me(n,t){const o={...t,version:n.version,lastSaveTimestampUTC:Date.now()};localStorage.setItem(Pe,JSON.stringify(o))}function O(n,t,o){return Math.max(t,Math.min(o,n))}function je(n,t){return 1+t.progression.prestigeMu*Math.sqrt(Math.max(0,n))}function Ve(n,t){const o=Math.max(1,Math.floor(n));return t.progression.d0*Math.pow(1+t.progression.dmgGrowthD,o-1)}function Ze(n,t){const o=Math.max(1,Math.floor(n)),l=t.progression.r0+t.progression.fireRateLogK*Math.log(1+o);return Math.min(t.progression.rMax,l)}function ut(n,t){const o=Math.max(1,Math.floor(n));return t.tower.baseRange+t.tower.rangeGrowth*(o-1)}function re(n,t){const o=new Map;for(const y of t.modules.defs)o.set(y.id,y);let l=1,e=0,a=0,d=0,c=t.tower.armorPierce0,u=0,T=1;for(let y=1;y<=t.modules.slotCount;y++){const S=n.modulesEquipped[y];if(!S||!n.modulesUnlocked[S])continue;const b=o.get(S);if(!b)continue;const k=Math.max(0,Math.floor(n.moduleLevels[S]??0));k<=0||(b.dmgMultPerLevel&&(l*=1+b.dmgMultPerLevel*k),b.dmgFlatPerLevel&&(e+=b.dmgFlatPerLevel*k),b.fireRateBonusPerLevel&&(a+=b.fireRateBonusPerLevel*k),b.rangeBonusPerLevel&&(d+=b.rangeBonusPerLevel*k),b.armorPiercePerLevel&&(c+=b.armorPiercePerLevel*k),b.baseHPBonusPerLevel&&(u+=b.baseHPBonusPerLevel*k),b.goldMultPerLevel&&(T*=1+b.goldMultPerLevel*k))}return{dmgMult:l,dmgFlat:e,fireRateBonus:a,rangeBonus:d,armorPierce:O(c,0,.9),baseHPBonus:u,goldMult:T}}function ie(n,t){const o=re(n,t),l=(Ve(n.towerUpgrades.damageLevel,t)*o.dmgMult+o.dmgFlat)*je(n.prestigePoints,t),e=Ze(n.towerUpgrades.fireRateLevel,t)*(1+o.fireRateBonus);return Math.max(0,l*e)}function Je(n,t){const o=Math.max(1,Math.floor(n)),{a:l,b:e,c:a,earlyEnd:d,midEnd:c}=t.progression;if(o<=d)return Math.pow(1+l,o-1);const u=Math.pow(1+l,d-1);return o<=c?u*Math.pow(1+e,o-d):u*Math.pow(1+e,c-d)*Math.pow(1+a,o-c)}function Se(n,t,o){const l=o.sim.waveDurationSec,e=o.progression.clearFactorRho,a=Je(n,o);return Math.max(1,t*l*e*a)}function Qe(n,t,o){const l=Math.max(1,Math.floor(n)),{nMin:e,u:a,v:d}=t.progression,c=e+Math.floor(a*Math.sqrt(l)+d*Math.log(1+l)),u=o==="low"?t.progression.nMaxLow:o==="med"?t.progression.nMaxMed:t.progression.nMaxHigh;return O(c,e,u)}function et(n,t){const o=Math.max(1,Math.floor(n)),{patternP1:l,patternP2:e,patternCountP:a}=t.progression;return((l*o+e)%a+a)%a}function mt(n,t,o,l){const e=Math.max(1,Math.floor(t)),a=Math.max(1,Math.floor(o)),d=l.sim.waveDurationSec,c=e/a,u=l.progression.spawnP;let T=d*Math.pow(c,u);const y=et(n,l);if(l.progression.burstPatternValues.includes(y)){const S=O(l.progression.burstTightness,0,1);T=T*(1-S)+d*c*S}return O(T,0,d)}function tt(n,t,o,l){const e=Math.max(1,Math.floor(n)),a=Math.max(1,Math.floor(t)),{enemyTypeA:d,enemyTypeB:c,enemyTypeC:u}=o.progression;return((d*e+c*a+u)%l+l)%l}function nt(n,t){const o=Math.max(1,Math.floor(n)),l=Math.max(2,Math.floor(t.progression.typeVariationM)),e=t.progression.typeVariationBeta,a=o%l/(l-1);return 1+e*(a-.5)}function vt(n,t,o,l,e){const a=e.enemies.types.length,d=tt(n,t,e,a),c=e.enemies.types[d],u=Math.max(1,o/Math.max(1,l)),T=nt(t,e),y=Math.max(1,u*T*c.hpMult),S=Math.min(e.progression.armorMax,e.progression.armorAlpha*Math.log(1+Math.max(1,n))),b=O(S*c.armorMult,0,e.progression.armorMax),k=Math.max(1,c.baseSpeed*(1+e.progression.speedK*Math.sqrt(Math.max(1,n))/100));return{type:c,hp:y,armor:b,speed:k}}function Ce(n,t){const o=Math.max(1,Math.floor(n)),{th0:l,thSlope:e,thMin:a,thMax:d}=t.progression;return O(l+e*Math.log(1+o),a,d)}function le(n,t,o){const l=O(n,0,1),e=O(t,1e-4,1);if(l>=e)return{penaltyFactor:1,deficit:0};const a=(e-l)/e;return{penaltyFactor:O(1-o.progression.penK*a,o.progression.penMin,1),deficit:a}}function Ee(n,t,o){const l=Math.max(1,Math.floor(n));return o.progression.g0*Math.pow(Math.max(1,t),o.progression.gamma)*(1+o.progression.goldWaveK*Math.log(1+l))}function xe(n,t){const o=Math.max(1,Math.floor(n)),l=Math.floor((o-1)/10);return Math.max(1,Math.ceil(t.progression.p0*Math.pow(t.progression.pointsGrowthPer10,l)))}function ot(n,t){const o=ie(n,t),l=Se(n.wave,o,t),e=Qe(n.wave,t,n.settings.quality),a=Ce(n.wave,t);return{wave:n.wave,dpsSnap:o,totalEHP:l,spawnCount:e,threshold:a}}function gt(n){const{snapshot:t,killed:o,escaped:l,cfg:e,state:a}=n,d=Math.max(1,t.spawnCount),c=O(o/d,0,1),{penaltyFactor:u,deficit:T}=le(c,t.threshold,e),S=Ee(t.wave,t.totalEHP,e)*u*re(a,e).goldMult,b=xe(t.wave,e),k=e.progression.enableEscapeDamage?l*e.progression.escapeDamage*(1+e.progression.deficitBoost*T):0;return{wave:t.wave,killed:o,escaped:l,killRatio:c,threshold:t.threshold,penaltyFactor:u,rewardGold:S,rewardPoints:b,baseDamageFromEscapes:k,dpsSnap:t.dpsSnap,totalEHP:t.totalEHP}}function Te(n){const{config:t,nowUTC:o}=n,l={...n.state},e={...n.state},a=Math.max(0,(o-e.lastSaveTimestampUTC)/1e3),d=t.sim.waveDurationSec,c=Math.floor(a/d);if(c<=0)return{hasOffline:!1,elapsedSec:a,offlineWaves:0,estimatedKillRatioNoteTR:"—",gainedGold:0,factorApplied:0,stateBefore:l,stateAfter:e};const u=n.rewarded?t.progression.rewardedOfflineFactor:t.progression.offlineFactor;let T=0,y=0;for(let S=1;S<=c;S++){const b=e.wave+(S-1),k=ie(e,t),U=Se(b,k,t),ee=O(t.progression.offlineKillK0+t.progression.offlineKillK1*Math.log(1+k/Math.max(1,U)),0,1),E=Ce(b,t),{penaltyFactor:R}=le(ee,E,t),te=Ee(b,U,t),q=re(e,t).goldMult;T+=te*R*u*q,y+=xe(b,t)}return e.gold+=T,e.points+=y,e.wave+=c,e.lastSaveTimestampUTC=o,{hasOffline:!0,elapsedSec:a,offlineWaves:c,estimatedKillRatioNoteTR:"Çevrimdışı Öldürme Oranı tahminidir (deterministik).",gainedGold:T,factorApplied:u,stateBefore:l,stateAfter:e}}function s(n,t){const o=document.createElement(n);return t&&(o.className=t),o}function M(n,t){const o=s("button",t??"btn");return o.type="button",o.textContent=n,o.dataset.ngBtn="1",o}function J(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function we(){const n=s("div");return n.style.height="1px",n.style.background="rgba(34,245,255,0.14)",n.style.margin="10px 0",n}function $(n,t,o=!1){const l=s("div","kv"),e=s("div","k");e.textContent=n;const a=s("div","v"+(o?" mono":""));return a.textContent=t,l.append(e,a),l}const ae=["","K","M","B","T"];function at(n){const o=Math.floor(n/26),l=n%26;return String.fromCharCode(97+o)+String.fromCharCode(97+l)}function K(n,t){if(!Number.isFinite(n))return"∞";if(n===0)return"0";const o=n<0?"-":"";let l=Math.abs(n);if(t==="scientific"){const u=Math.floor(Math.log10(l)),T=l/Math.pow(10,u);return`${o}${T.toFixed(3)}e${u}`}if(l<1e3)return`${o}${l.toFixed(l<10?2:l<100?1:0)}`;const e=Math.floor(Math.log10(l)/3),a=l/Math.pow(10,e*3);if(e<ae.length){const u=ae[e];return`${o}${a.toFixed(a<10?2:1)}${u}`}const d=e-ae.length,c=at(d);return`${o}${a.toFixed(a<10?2:1)}${c}`}function Q(n){const t=Math.max(0,n),o=Math.floor(t/60),l=Math.floor(t%60);return`${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}`}function st(n){return`${(Math.max(0,Math.min(1,n))*100).toFixed(0)}%`}function rt(n,t){const o=Math.max(1,Math.floor(n));return t.economy.upgradeCostBase*Math.pow(t.economy.upgradeCostGrowth,o-1)}function it(n,t){const o=Math.max(0,Math.floor(n));return Math.ceil(t.economy.moduleUnlockPointCostBase*Math.pow(t.economy.moduleUnlockPointCostGrowth,o))}function lt(n,t){const o=Math.max(0,Math.floor(n));return t.economy.moduleUpgradeGoldBase*Math.pow(t.economy.moduleUpgradeGoldGrowth,o)}function dt(n){const{root:t,config:o}=n;if(J(t),!t.__ngBtnBridgeInstalled){t.__ngBtnBridgeInstalled=!0;const i=new WeakMap;t.addEventListener("pointerdown",r=>{const p=r;if(!p.isPrimary||typeof p.button=="number"&&p.button!==0)return;const f=p.target?.closest?.('button[data-ng-btn="1"]');if(!f||f.disabled)return;i.set(f,performance.now()),p.preventDefault();const v=f.onclick;v&&v.call(f,new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))},!0),t.addEventListener("click",r=>{const m=r.target?.closest?.('button[data-ng-btn="1"]');if(!m)return;const f=i.get(m);f&&(performance.now()-f>800||(r.preventDefault(),r.stopImmediatePropagation(),i.delete(m)))},!0)}(()=>{try{return typeof location<"u"&&new URLSearchParams(location.search).get("debugClicks")==="1"}catch{return!1}})();const l=s("div","ui-layer");t.appendChild(l);let e=null,a=null,d=null,c="ALL",u=n.initialState;const T=s("div","hud-top"),y=s("div");y.style.flex="1",y.style.minHeight="0",y.style.overflow="auto";const S=s("div");l.append(T,y,S);function b(i){const r=s("div");return r.className="ng-modal-overlay",r.style.position="absolute",r.style.inset="0",r.style.pointerEvents="auto",r.style.zIndex="10000",t.appendChild(r),r.appendChild(i),r}function k(){t.querySelectorAll(".ng-modal-overlay").forEach(r=>{r.firstElementChild||r.remove()})}function U(i){i.classList.add("btn-danger"),window.setTimeout(()=>i.classList.remove("btn-danger"),260)}function ee(i){if(d)return d;const r=ot(i,o);return{state:i,wave:r,waveTimeSec:0,killed:0,escaped:0,spawnedSoFar:0,timeScale:1,paused:!0,auto:!0,enemies:[],projectiles:[],arena:{center:{x:0,y:0},bounds:{left:0,top:0,right:0,bottom:0},maxSpawnDist:1,baseHalfSize:1},tower:{pos:{x:0,y:0},range:0,armorPierce:0,damagePerShot:0,fireRate:0}}}function E(i){u=i,R()}function R(){if(k(),J(T),J(y),J(S),u==="boot"){te();return}if(u==="offline"){q(),de(!0);return}if(u==="menu"){q();return}de(u!=="hud"),u==="modules"&&Fe(),u==="prestige"&&Ue(),u==="settings"&&De(),u==="stats"&&Be()}function te(){const i=s("div","panel");i.style.maxWidth="520px",i.style.margin="auto",i.style.pointerEvents="auto";const r=s("div","panel-header"),p=s("div");p.textContent="NEON GRID",r.appendChild(p);const m=s("div","muted");m.textContent="No RNG / Deterministic",r.appendChild(m);const f=s("div","panel-body"),v=s("div");v.textContent="Deterministik simülasyon başlatılıyor…",v.style.marginBottom="10px";const g=s("div","bar"),h=s("div","fill");h.style.width="0%",g.appendChild(h);const w=s("div","muted");w.style.marginTop="10px";const P=o.ui.tipsTR,C=Math.floor(Date.now()/864e5);w.textContent=`İpucu: ${P[C%P.length]}`,f.append(v,g,w),i.append(r,f),y.appendChild(i);let x=0;const L=window.setInterval(()=>{x+=.08,h.style.width=`${Math.min(100,x*100)}%`,x>=1&&(window.clearInterval(L),E("menu"))},60)}function q(){const i=s("div","panel");i.style.maxWidth="560px",i.style.margin="auto";const r=s("div","panel-header"),p=s("div");p.textContent="NEON GRID",r.appendChild(p);const m=s("div","muted mono");m.textContent=`v${o.version}`,r.appendChild(m);const f=s("div","panel-body"),v=s("div","muted");v.textContent="Raslantı yok: Tüm sonuçlar deterministiktir. Dalga süresi sabittir.";const g=s("div","stack");g.style.marginTop="12px";const h=M("Devam Et","btn btn-primary");h.onclick=()=>{e&&(e.setPaused(!1),E("hud"))};const w=M("Yeni Koşu","btn");w.onclick=()=>{e&&(e.newRun(),E("hud"))};const P=M("Ayarlar","btn");P.onclick=()=>E("settings");const C=M("Credits","btn");C.onclick=()=>{alert(`NEON GRID — Deterministic Idle Tower Defense
UI/Sim prototype skeleton.`)},g.append(h,w,P,C);const x=s("div","panel");x.style.marginTop="12px";const L=s("div","panel-header");L.textContent="No RNG Mode";const D=s("div","panel-body");D.innerHTML=`
      <div class="muted">• Spawn düzeni, enemy tipi, ödül ve ceza: deterministik formüllerle.</div>
      <div class="muted">• Kill Ratio hedefi tutmazsa: ödül çarpanı düşer, kaçanlar base’e ekstra hasar verir.</div>
      <div class="muted">• Her dalga tam ${o.sim.waveDurationSec.toFixed(1)}s sürer.</div>
    `,x.append(L,D),f.append(v,g,x),i.append(r,f),y.appendChild(i)}function de(i){const r=a;if(!r)return;const p=ee(r),m=s("div","panel"),f=s("div","hud-topbar"),v=Math.max(0,o.sim.waveDurationSec-p.waveTimeSec);f.append($("Dalga",String(r.wave),!0),$("Süre",Q(v),!0),$("Altın",K(r.gold,r.settings.numberFormat),!0),$("Puan",K(r.points,r.settings.numberFormat),!0),$("DPS (snap)",K(p.wave.dpsSnap,r.settings.numberFormat),!0),$("HP",`${K(r.baseHP,"suffix")}`,!0));const g=s("div","panel-body"),h=p.spawnedSoFar<=0?0:O(p.killed/Math.max(1,p.spawnedSoFar),0,1),w=p.wave.threshold,{penaltyFactor:P}=le(h,w,o),C=s("div");C.style.display="flex",C.style.alignItems="center",C.style.justifyContent="space-between",C.style.gap="10px";const x=s("div");x.innerHTML=`<div class="muted">Öldürme Oranı</div><div class="mono" style="font-weight:800">${h.toFixed(2)} / Hedef ${w.toFixed(2)}</div>`;const L=s("div");L.innerHTML=`<div class="muted">Ceza Çarpanı</div><div class="mono" style="font-weight:800; color:${P<1?"var(--danger)":"var(--neon-lime)"}">x${P.toFixed(2)}</div>`,C.append(x,L);const D=s("div","bar"+(P<1?" warn":"")),H=s("div","fill");H.style.width=`${Math.floor(h*100)}%`,D.appendChild(H),g.append(C,D),m.append(f,g),T.appendChild(m);const _=s("div","panel"),G=s("div","bottom-bar"),z=s("div","stack"),F=M("1x","btn"),B=M("2x","btn"),I=M("4x","btn");[F,B,I].forEach(X=>X.style.minWidth="58px"),F.onclick=()=>e?.setTimeScale(1),B.onclick=()=>e?.setTimeScale(2),I.onclick=()=>e?.setTimeScale(4);const N=M(p.auto?"Auto: AÇIK":"Auto: KAPALI","btn");N.onclick=()=>{e?.toggleAuto(),R()};const A=M(p.paused?"Devam":"Duraklat","btn");A.onclick=()=>{e?.setPaused(!p.paused),R()},z.append(F,B,I,N,A);const W=s("div","stack"),ce=M("Yükseltmeler","btn");ce.onclick=()=>E("hud");const pe=M("Modüller","btn");pe.onclick=()=>E("modules");const ue=M("İstatistikler","btn");ue.onclick=()=>E("stats");const me=M("Prestij","btn");me.onclick=()=>E("prestige");const ve=M("Ayarlar","btn");if(ve.onclick=()=>E("settings"),W.append(ce,pe,ue,me,ve),G.append(z,W),_.appendChild(G),S.appendChild(_),!i){const X=s("div","row");X.style.pointerEvents="auto",X.style.alignItems="stretch";const V=s("div","panel");V.style.width="320px",V.style.pointerEvents="auto";const ge=s("div","panel-header");ge.textContent="Yükseltmeler";const Y=s("div","panel-body");Y.appendChild(j("Hasar","damage",r.towerUpgrades.damageLevel)),Y.appendChild(j("Atış Hızı","fireRate",r.towerUpgrades.fireRateLevel)),Y.appendChild(j("Menzil","range",r.towerUpgrades.rangeLevel)),Y.appendChild(j("Base HP","baseHP",r.towerUpgrades.baseHPLevel)),V.append(ge,Y);const Z=s("div","panel");Z.style.width="320px",Z.style.pointerEvents="auto";const fe=s("div","panel-header");fe.textContent="Canlı Rapor";const he=s("div","panel-body"),ye=s("div","muted");ye.innerHTML=`
        <div>Spawn: <span class="mono">${p.spawnedSoFar}/${p.wave.spawnCount}</span></div>
        <div>Öldürülen: <span class="mono">${p.killed}</span></div>
        <div>Kaçan: <span class="mono">${p.escaped}</span></div>
        <div>Beklenen Ceza: <span class="mono">x${P.toFixed(2)}</span></div>
      `;const $e=ie(r,o),ne=s("div","muted");ne.style.marginTop="10px",ne.innerHTML=`
        <div>Build DPS (anlık): <span class="mono">${K($e,r.settings.numberFormat)}</span></div>
        <div>Zırh Delme: <span class="mono">${st(p.tower.armorPierce)}</span></div>
      `,he.append(ye,we(),ne),Z.append(fe,he);const oe=s("div");oe.style.flex="1",oe.style.pointerEvents="none",X.append(V,oe,Z),y.appendChild(X)}}function j(i,r,p){const m=s("div");m.style.display="grid",m.style.gridTemplateColumns="1fr auto",m.style.gap="10px",m.style.alignItems="center",m.style.marginBottom="10px";const f=s("div");f.innerHTML=`<div style="font-weight:800">${i}</div><div class="muted mono">Lv ${p} • Sonraki: ${K(rt(p,o),a?.settings.numberFormat??"suffix")}</div>`;const v=s("div","stack"),g=M("+1","btn"),h=M("+10","btn"),w=M("+Max","btn");return g.onclick=()=>{if(!e){U(g);return}if(!e.buyUpgrade(r,1)){U(g);return}a=e.getSnapshot(),R()},h.onclick=()=>{if(!e){U(h);return}if(!e.buyUpgrade(r,10)){U(h);return}a=e.getSnapshot(),R()},w.onclick=()=>{if(!e){U(w);return}if(!e.buyUpgrade(r,"max")){U(w);return}a=e.getSnapshot(),R()},v.append(g,h,w),m.append(f,v),m}function Fe(){if(!e||!a)return;const i=s("div","panel");i.style.maxWidth="920px",i.style.margin="0 auto",i.style.pointerEvents="auto",i.style.height="100%",i.style.maxHeight="100%",i.style.display="flex",i.style.flexDirection="column";const r=s("div","panel-header");r.appendChild(s("div")).textContent="Modüller";const p=M("Geri","btn");p.onclick=()=>E("hud"),r.appendChild(p);const m=s("div","panel-body");m.style.flex="1",m.style.minHeight="0",m.style.overflow="auto";const f=s("div","stack"),v=(w,P)=>{const C=M(w,"btn");return C.onclick=()=>{c=P,R()},C};f.append(v("Tümü","ALL"),v("OFFENSE","OFFENSE"),v("DEFENSE","DEFENSE"),v("UTILITY","UTILITY"));const g=s("div");g.style.display="grid",g.style.gridTemplateColumns="repeat(auto-fit, minmax(240px, 1fr))",g.style.gap="10px",g.style.marginTop="12px";const h=Object.values(a.modulesUnlocked).filter(Boolean).length;for(const w of o.modules.defs){if(c!=="ALL"&&w.category!==c)continue;const P=s("div","panel"),C=s("div","panel-header"),x=s("div");x.textContent=w.nameTR;const L=s("div","muted mono");L.textContent=w.category,C.append(x,L);const D=s("div","panel-body"),H=s("div","muted");H.textContent=Re(w);const _=s("div","muted");_.style.marginTop="6px",_.textContent=`İkon: ${w.iconConcept}`;const G=s("div","stack");if(G.style.marginTop="10px",!!a.modulesUnlocked[w.id]){const F=a.moduleLevels[w.id]??0,B=lt(F,o),I=M(`+1 (₲${K(B,a.settings.numberFormat)})`,"btn");I.onclick=()=>{if(!e)return;if(!e.upgradeModule(w.id,1)){U(I);return}a=e.getSnapshot(),R()};const N=M("+10","btn");N.onclick=()=>{if(!e)return;if(!e.upgradeModule(w.id,10)){U(N);return}a=e.getSnapshot(),R()};const A=M("+Max","btn");A.onclick=()=>{if(!e)return;if(!e.upgradeModule(w.id,"max")){U(A);return}a=e.getSnapshot(),R()},G.append($("Seviye",String(F),!0),I,N,A)}else{const F=it(h,o),B=M(`Aç (${F} puan)`,"btn btn-primary");B.onclick=()=>{if(!e)return;if(!e.unlockModule(w.id)){U(B);return}a=e.getSnapshot(),R()},G.appendChild(B)}D.append(H,_,G),P.append(C,D),g.appendChild(P)}m.append(f,g),i.append(r,m),y.appendChild(i)}function Re(i){const r=[];return i.dmgMultPerLevel&&r.push(`Hasar Çarpanı: +${(i.dmgMultPerLevel*100).toFixed(1)}% / seviye`),i.dmgFlatPerLevel&&r.push(`Düz Hasar: +${i.dmgFlatPerLevel} / seviye`),i.fireRateBonusPerLevel&&r.push(`Atış Hızı: +${(i.fireRateBonusPerLevel*100).toFixed(1)}% / seviye`),i.rangeBonusPerLevel&&r.push(`Menzil: +${i.rangeBonusPerLevel} / seviye`),i.armorPiercePerLevel&&r.push(`Zırh Delme: +${(i.armorPiercePerLevel*100).toFixed(1)}% / seviye`),i.baseHPBonusPerLevel&&r.push(`Base HP: +${i.baseHPBonusPerLevel} / seviye`),i.goldMultPerLevel&&r.push(`Altın Çarpanı: +${(i.goldMultPerLevel*100).toFixed(1)}% / seviye`),r.length?r.join(" • "):"Etki: (tanımlı değil)"}function Ue(){if(!e||!a)return;const i=s("div","panel");i.style.maxWidth="720px",i.style.margin="auto",i.style.pointerEvents="auto";const r=s("div","panel-header");r.appendChild(s("div")).textContent="RESET PROTOCOL";const p=M("Geri","btn");p.onclick=()=>E("hud"),r.appendChild(p);const m=s("div","panel-body"),f=s("div","muted");f.innerHTML=`
      <div>En Yüksek Dalga: <span class="mono">${a.stats.bestWave}</span></div>
      <div>Toplam Süre: <span class="mono">${Q(a.stats.totalTimeSec)}</span></div>
      <div>Prestij Puanı: <span class="mono">${a.prestigePoints}</span></div>
    `;const v=s("div","muted");v.style.marginTop="10px",v.textContent="Prestij çarpanı: 1 + μ·sqrt(P). (Deterministik)";const g=s("div","panel");g.style.marginTop="12px";const h=s("div","panel-header");h.textContent="Onay";const w=s("div","panel-body"),P=M("Basılı Tut: Onayla","btn btn-danger");P.style.width="100%";let C=null;P.onpointerdown=()=>{P.textContent="Tutmaya devam…",C=window.setTimeout(()=>{C=null;const L=e.prestigeReset();L.ok?(alert(`Prestij kazanıldı: +${L.gained}`),E("hud")):alert("Prestij için yeterli koşul yok (şimdilik).")},900)};const x=()=>{C&&window.clearTimeout(C),C=null,P.textContent="Basılı Tut: Onayla"};P.onpointerup=x,P.onpointerleave=x,P.onpointercancel=x,w.appendChild(P),g.append(h,w),m.append(f,v,g),i.append(r,m),y.appendChild(i)}function De(){if(!e||!a)return;const i=s("div","panel");i.style.maxWidth="820px",i.style.margin="auto",i.style.pointerEvents="auto";const r=s("div","panel-header");r.appendChild(s("div")).textContent="Ayarlar";const p=M("Geri","btn");p.onclick=()=>E("hud"),r.appendChild(p);const m=s("div","panel-body"),f=s("div");f.innerHTML='<div style="font-weight:800">Ses</div>';const v=document.createElement("input");v.type="range",v.min="0",v.max="1",v.step="0.01",v.value=String(a.settings.audioMaster),v.oninput=()=>{a.settings.audioMaster=Number(v.value),e.setSnapshot({...a})},f.appendChild(v);const g=s("div");g.style.marginTop="12px",g.innerHTML='<div style="font-weight:800">Kalite</div>';const h=document.createElement("select");h.className="btn",h.style.width="100%",["low","med","high"].forEach(N=>{const A=document.createElement("option");A.value=N,A.textContent=N.toUpperCase(),a.settings.quality===N&&(A.selected=!0),h.appendChild(A)}),h.onchange=()=>{a.settings.quality=h.value,e.setSnapshot({...a})},g.appendChild(h);const w=s("div");w.style.marginTop="12px",w.innerHTML='<div style="font-weight:800">Sayı Formatı</div>';const P=s("div","stack"),C=M("Suffix","btn"),x=M("Scientific","btn");C.onclick=()=>{a.settings.numberFormat="suffix",e.setSnapshot({...a})},x.onclick=()=>{a.settings.numberFormat="scientific",e.setSnapshot({...a})},P.append(C,x);const L=s("div");L.style.marginTop="12px";const D=document.createElement("input");D.type="checkbox",D.checked=a.settings.reduceEffects,D.onchange=()=>{a.settings.reduceEffects=D.checked,e.setSnapshot({...a})};const H=s("label","muted");H.style.display="flex",H.style.gap="10px",H.style.alignItems="center",H.append(D,document.createTextNode("Efektleri azalt (motion/glow)")),L.appendChild(H);const _=s("div","panel");_.style.marginTop="12px";const G=s("div","panel-header");G.textContent="Save Export/Import";const z=s("div","panel-body"),F=document.createElement("textarea");F.className="mono",F.style.width="100%",F.style.minHeight="120px",F.placeholder="Save text…";const B=M("Export","btn");B.onclick=async()=>{F.value=JSON.stringify(e.getSnapshot()),await navigator.clipboard.writeText(F.value),alert("Kopyalandı.")};const I=M("Import (Replace)","btn btn-danger");I.onclick=()=>{try{const N=JSON.parse(F.value);e.setSnapshot(N),alert("Yüklendi.")}catch{alert("Geçersiz metin.")}},z.append(F,s("div","stack")),z.lastElementChild.append(B,I),_.append(G,z),m.append(f,g,w,P,L,_),i.append(r,m),y.appendChild(i)}function Be(){if(!a)return;const i=s("div","panel");i.style.maxWidth="920px",i.style.margin="auto",i.style.pointerEvents="auto";const r=s("div","panel-header");r.appendChild(s("div")).textContent="Codex / İstatistikler";const p=M("Geri","btn");p.onclick=()=>E("hud"),r.appendChild(p);const m=s("div","panel-body");m.append($("Toplam Öldürme",String(a.stats.totalKills),!0),$("Toplam Kaçış",String(a.stats.totalEscapes),!0),$("En Yüksek Dalga",String(a.stats.bestWave),!0),$("Koşu Sayısı",String(a.stats.runsCount),!0)),m.appendChild(we());const f=s("div","muted");f.innerHTML='<div style="font-weight:800">Enemy Tipleri</div>';for(const g of o.enemies.types){const h=s("div","muted");h.innerHTML=`• <span class="mono">${g.id}</span> — ${g.nameTR} (hp×${g.hpMult}, armor×${g.armorMult})`,f.appendChild(h)}const v=s("div","muted");v.style.marginTop="10px",v.innerHTML=`
      <div style="font-weight:800">Deterministik Formüller</div>
      <div class="mono">enemy_type(w,i) = (A·w + B·i + C) mod K</div>
      <div class="mono">t_i = T · (i/N)^p</div>
      <div class="mono">TotalEHP(w) = DPS_snap · T · ρ · G(w)</div>
    `,m.append(f,v),i.append(r,m),y.appendChild(i)}function Ne(i){const r=s("div","panel");r.style.position="absolute",r.style.left="50%",r.style.top="18%",r.style.transform="translateX(-50%)",r.style.width="min(680px, calc(100vw - 24px))",r.style.pointerEvents="auto";const p=s("div","panel-header");p.textContent="WAVE COMPLETE";const m=s("div","panel-body"),f=i.penaltyFactor<1;m.innerHTML=`
      <div class="muted">Öldürülen: <span class="mono">${i.killed}</span> • Kaçan: <span class="mono">${i.escaped}</span></div>
      <div class="muted">KR: <span class="mono">${i.killRatio.toFixed(2)}</span> • Hedef: <span class="mono">${i.threshold.toFixed(2)}</span></div>
      <div class="muted">Ödül: <span class="mono">${K(i.rewardGold,a?.settings.numberFormat??"suffix")}</span> altın • <span class="mono">${i.rewardPoints}</span> puan</div>
      <div class="muted" style="margin-top:6px; color:${f?"var(--danger)":"var(--neon-lime)"}">Ceza Çarpanı: <span class="mono">x${i.penaltyFactor.toFixed(2)}</span></div>
    `;const v=M("Devam","btn btn-primary"),g=b(r);v.onclick=()=>{g.remove()};const h=s("div","stack");h.style.marginTop="10px",h.appendChild(v),m.appendChild(h),r.append(p,m),window.setTimeout(()=>{g.isConnected&&g.remove()},o.sim.autoOverlayCloseSec*1e3)}function Oe(i){E("offline");const r=s("div","panel");r.style.position="absolute",r.style.left="50%",r.style.top="14%",r.style.transform="translateX(-50%)",r.style.width="min(720px, calc(100vw - 24px))",r.style.pointerEvents="auto";const p=s("div","panel-header");p.textContent="WHILE YOU WERE OFFLINE";const m=s("div","panel-body");m.innerHTML=`
      <div class="muted">Süre: <span class="mono">${Q(i.elapsedSec)}</span></div>
      <div class="muted">Tahmini dalga: <span class="mono">${i.offlineWaves}</span></div>
      <div class="muted">Kazanç: <span class="mono">${K(i.gainedGold,a?.settings.numberFormat??"suffix")}</span> (x${i.factorApplied.toFixed(2)})</div>
      <div class="muted" style="margin-top:6px">Not: ${i.estimatedKillRatioNoteTR}</div>
    `;const f=b(r),v=M("Topla","btn btn-primary");v.onclick=()=>{e&&(e.setSnapshot(i.stateAfter),e.setPaused(!1),f.remove(),E("menu"))};const g=M("2x için Reklam İzle (deterministik çarpan)","btn");g.onclick=()=>{alert("Bu prototipte reklam yok; çarpan demo amaçlı. İstersen UI entegrasyonu ekleriz.")};const h=s("div","stack");h.style.marginTop="10px",h.append(v,g),m.appendChild(h),r.append(p,m)}function He(i){const r=s("div","panel");r.style.position="absolute",r.style.left="50%",r.style.top="18%",r.style.transform="translateX(-50%)",r.style.width="min(640px, calc(100vw - 24px))",r.style.pointerEvents="auto";const p=s("div","panel-header");p.textContent="RUN ENDS";const m=s("div","panel-body");m.innerHTML=`
      <div class="muted">Bittiği Dalga: <span class="mono">${i.endedAtWave}</span></div>
      <div class="muted">Toplam Altın: <span class="mono">${K(i.totalGoldThisRun,a?.settings.numberFormat??"suffix")}</span></div>
      <div class="muted">Süre: <span class="mono">${Q(i.totalTimeSec)}</span></div>
    `;const f=b(r),v=s("div","stack");v.style.marginTop="10px";const g=M("Menü","btn");g.onclick=()=>{f.remove(),E("menu")};const h=M("Yeni Koşu","btn btn-primary");h.onclick=()=>{f.remove(),e?.newRun(),E("hud")},v.append(g,h),m.appendChild(v),r.append(p,m)}function Ie(i){e=i;let r=!1;e.onSim(p=>{d=p,a=p.state,!r&&(r=!0,requestAnimationFrame(()=>{r=!1,(u==="hud"||u==="modules"||u==="prestige"||u==="settings"||u==="stats")&&R()}))}),a=i.getSnapshot(),d=null,R(),u==="boot"&&R()}function Ae(i){a=i}return{bindGame:Ie,setHUDState:Ae,setScreen:E,showWaveComplete:Ne,showOffline:Oe,showGameOver:He}}function ct(){const n=globalThis.Math,t=n.random;let o=0;return n.random=(()=>(o++,0)),{restore:()=>{n.random=t},getCalls:()=>o}}async function pt(n){const t=ze;ct();const o=Date.now(),l=Ye(t,o),e=Te({state:l.state,nowUTC:o,config:t}),a=dt({root:n.uiRoot,config:t,initialState:e.hasOffline?"offline":"boot"}),{createGame:d}=await Ke(async()=>{const{createGame:u}=await import("./createGame-BQDfhMD0.js");return{createGame:u}},[]),c=d({parent:n.gameRoot,config:t,initialState:l.state,onWaveComplete:u=>a.showWaveComplete(u),onStateChanged:u=>{a.setHUDState(u),Me(t,u)},onGameOver:u=>a.showGameOver(u)});a.bindGame(c),e.hasOffline&&(c.setPaused(!0),a.showOffline(e)),document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="hidden"){const S=c.getSnapshot();Me(t,S);return}const u=Date.now(),T=c.getSnapshot(),y=Te({state:T,nowUTC:u,config:t});y.hasOffline&&(c.setPaused(!0),a.showOffline(y))})}const ke=document.querySelector("#game"),Le=document.querySelector("#ui");if(!ke||!Le)throw new Error("Missing #game or #ui root elements");pt({gameRoot:ke,uiRoot:Le});export{re as a,Ve as b,ot as c,mt as d,vt as e,Ze as f,O as g,gt as h,it as i,se as j,lt as m,ut as t,rt as u};
